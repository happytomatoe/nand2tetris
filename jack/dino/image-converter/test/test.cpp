#include <gtest/gtest.h>
#include <gmock/gmock-matchers.h>
#include <converter/ImageConverter.hpp>
#include "dino.cpp"

#include <cpptrace/cpptrace.hpp>
using namespace std;
// TEST(ConverterTest, ReadTest) {
//     auto im = ImageConverter::read(text);
//     ASSERT_EQ(im.height, 43);
//     ASSERT_EQ(im.width, 40);
//     cout << im;
//     // ASSERT_EQ(im.pixels.size(), im.height);
// }


// TEST(ConverterTest, ConvertTest) {
//      auto image = Image{2, 2, {0, 255, 255, 0}};
//      auto res = ImageConverter::convert(image);
//      cout << res;
// }
// const uint16_t dino_with_white[43][40] = {
// 	{65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535},
// 	{65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535},
// 	{65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
// 	{65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
// 	{65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
// 	{65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
// 	{65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
// 	{65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
// 	{65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
// 	{65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
// 	{65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
// 	{65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535},
// 	{65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535},
// 	{65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535,65535,65535},
// 	{65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535,65535,65535},
// 	{0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535},
// 	{0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535},
// 	{0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535},
// 	{0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535},
// 	{0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535},
// 	{0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535},
// 	{0,0,0,0,0,0,65535,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535,0,0,65535,65535,65535,65535,65535,65535,65535,65535},
// 	{0,0,0,0,0,0,65535,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535,0,0,65535,65535,65535,65535,65535,65535,65535,65535},
// 	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535},
// 	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535},
// 	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535},
// 	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535},
// 	{65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535},
// 	{65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535},
// 	{65535,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535},
// 	{65535,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535},
// 	{65535,65535,65535,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535},
// 	{65535,65535,65535,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535},
// 	{65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535},
// 	{65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535},
// 	{65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,0,0,65535,65535,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535},
// 	{65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,0,0,65535,65535,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535},
// 	{65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,65535,65535,65535,65535,65535,65535,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535},
// 	{65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,65535,65535,65535,65535,65535,65535,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535},
// 	{65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,65535,65535,65535,65535,65535,65535,65535,65535,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535},
// 	{65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,65535,65535,65535,65535,65535,65535,65535,65535,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535},
// 	{65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,65535,65535,65535,65535,65535,65535,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535},
// 	{65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,65535,65535,65535,65535,65535,65535,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535},
//
// };
static const uint16_t dino_with_white[] = {
    0b11111111, 0b11111111, 0b11111100, 0b00000000, 0b00000011,
    0b11111111, 0b11111111, 0b11111100, 0b00000000, 0b00000011,
    0b11111111, 0b11111111, 0b11110000, 0b00000000, 0b00000000,
    0b11111111, 0b11111111, 0b11110000, 0b11000000, 0b00000000,
    0b11111111, 0b11111111, 0b11110000, 0b11000000, 0b00000000,
    0b11111111, 0b11111111, 0b11110000, 0b00000000, 0b00000000,
    0b11111111, 0b11111111, 0b11110000, 0b00000000, 0b00000000,
    0b11111111, 0b11111111, 0b11110000, 0b00000000, 0b00000000,
    0b11111111, 0b11111111, 0b11110000, 0b00000000, 0b00000000,
    0b11111111, 0b11111111, 0b11110000, 0b00000000, 0b00000000,
    0b11111111, 0b11111111, 0b11110000, 0b00000000, 0b00000000,
    0b11111111, 0b11111111, 0b11110000, 0b00000011, 0b11111111,
    0b11111111, 0b11111111, 0b11110000, 0b00000011, 0b11111111,
    0b11111111, 0b11111111, 0b11110000, 0b00000000, 0b00001111,
    0b11111111, 0b11111111, 0b11110000, 0b00000000, 0b00001111,
    0b00111111, 0b11111111, 0b11000000, 0b00001111, 0b11111111,
    0b00111111, 0b11111111, 0b11000000, 0b00001111, 0b11111111,
    0b00111111, 0b11111110, 0b00000000, 0b00001111, 0b11111111,
    0b00111111, 0b11111110, 0b00000000, 0b00001111, 0b11111111,
    0b00001111, 0b11110000, 0b00000000, 0b00000000, 0b11111111,
    0b00001111, 0b11110000, 0b00000000, 0b00000000, 0b11111111,
    0b00000011, 0b11000000, 0b00000000, 0b00001100, 0b11111111,
    0b00000011, 0b11000000, 0b00000000, 0b00001100, 0b11111111,
    0b00000000, 0b00000000, 0b00000000, 0b00001111, 0b11111111,
    0b00000000, 0b00000000, 0b00000000, 0b00001111, 0b11111111,
    0b00000000, 0b00000000, 0b00000000, 0b00001111, 0b11111111,
    0b00000000, 0b00000000, 0b00000000, 0b00001111, 0b11111111,
    0b11000000, 0b00000000, 0b00000000, 0b00001111, 0b11111111,
    0b11000000, 0b00000000, 0b00000000, 0b00111111, 0b11111111,
    0b11110000, 0b00000000, 0b00000000, 0b00111111, 0b11111111,
    0b11110000, 0b00000000, 0b00000000, 0b00111111, 0b11111111,
    0b11111100, 0b00000000, 0b00000000, 0b11111111, 0b11111111,
    0b11111100, 0b00000000, 0b00000000, 0b11111111, 0b11111111,
    0b11111111, 0b00000000, 0b00000011, 0b11111111, 0b11111111,
    0b11111111, 0b00000000, 0b00000011, 0b11111111, 0b11111111,
    0b11111111, 0b11000000, 0b11000011, 0b11111111, 0b11111111,
    0b11111111, 0b11000000, 0b11000011, 0b11111111, 0b11111111,
    0b11111111, 0b11000011, 0b11110011, 0b11111111, 0b11111111,
    0b11111111, 0b11000011, 0b11110011, 0b11111111, 0b11111111,
    0b11111111, 0b11001111, 0b11110011, 0b11111111, 0b11111111,
    0b11111111, 0b11001111, 0b11110011, 0b11111111, 0b11111111,
    0b11111111, 0b11000011, 0b11110000, 0b11111111, 0b11111111,
    0b11111111, 0b11000011, 0b11110000, 0b11111111
};
TEST(ConverterTest, WholeTest) {
    //size of array
    Image im(43, 40, dino_with_white);
    cout << im;
    auto res = ImageConverter::convert(im);
    cout << res;
    ASSERT_EQ(im.pixels.size(), im.rows);
}


void sigsegv_handler(int sig) {
    cpptrace::generate_trace().print();
    exit(1);
}


int main(int argc, char **argv) {
    signal(SIGSEGV, sigsegv_handler);
    testing::InitGoogleTest(&argc, argv);
    return RUN_ALL_TESTS();
}
